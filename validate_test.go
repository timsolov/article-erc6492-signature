package signature

import (
	"context"
	"testing"

	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/ethclient"
	"github.com/stretchr/testify/require"
)

func TestValidator_ValidateERC6492(t *testing.T) {
	// Connect to the Ethereum RPC provider
	client, err := ethclient.Dial("https://api.zan.top/public/eth-mainnet")
	require.NoError(t, err, "Failed to connect to Ethereum RPC provider")

	// Initialize validator
	validator, err := NewValidator(client)
	require.NoError(t, err, "Failed to initialize Validator")

	// Prepared test data
	wallet := common.HexToAddress("0x8370dbe1ea2114C194f64B03090a06209C63Dd26")
	hash := common.FromHex("5b001f2ad81fe86899545b51f8ecd1ca08674437d5c4748e1b70ba5dcf85ed86")
	signature := common.FromHex("0x000000000000000000000000bf07a0df119ca234634588fbdb5625594e2a5bca0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000000e49c4ae2d000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000007a7f00000000000000000000000000000000000000000000000000000000000000017f52a3f96cf86f0e71015f37d3d7d5f8d856997f6bc39b9236de51a1b1d26a064e553d602d80604d3d3981f3363d3d373d3d3d363d732a2b85eb1054d6f0c6c2e37da05ed3e5fea684ef5af43d82803e903d91602b57fd5bf3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000042ef36ecf8d6a159fafc90f1412267f45ac795a1da985121c4703ec1186a7206250161c78a222c7c5060d0f4724c1dad2b400cdb208c542a55cb1da35fdd022de61c000000000000000000000000000000000000000000000000000000000000006492649264926492649264926492649264926492649264926492649264926492")

	// Validate signature using the Validate method
	valid, err := validator.Validate(context.Background(), wallet, common.BytesToHash(hash), signature)
	require.NoError(t, err, "Validation failed")
	require.True(t, valid, "Expected signature to be valid")
}
